---
description: 
globs: 
alwaysApply: true
---
Always respond in Russian (with English terms) but all the code, comments, content and textblock in code must be in English (with exception for md-files).

When running console commands keep in mind that environment is Windows 11 with PowerShell (use `;` instead of `&&` etc). However users runs code in WSL so it there is some issues in running console commands then provide instructions for user and ask him for assistance.

When using modern libraries do not trust to your internal memory and keep looking into their documentation online. As an index save links to relevant documentation in separate "references.md" file in project root folder and search it for documentation first. Look for any existing sections in this file and not duplicate them to keep a strict document structure.

Проект представляет из себя монорепо с пакетами фреймворка OneBun на платформе bun.js, реализуемый в стиле и под влиянием nest.js. В проекта используется TypeScript со всеми лучшими практиками (минимально количество any типов, например) и никакого JavaScript. Идея проекта в том, чтобы на каждую проблему был ровно один дефолтный/встроенный способ её решения, т.е. жертвуем гибкостью ради сторости разработки и производительности. Так же жертвуем обратной совместимостью с node.js, рассчитывая, что фреймворк будет использоваться исключительно в рантайме bun.js поэтому пакеты без сборки как таковой - пользуемся встроенной возможностью запускать ts файлы в bun.

Стек: bun v1.2.2, effect

Список фич фреймворка:
- core
  - decorators: базовые декораторы, аналогичные nest.js
  - envs: загрузка и управление переменными окружения, загрузка из файлов, изменение на лету, строгая типизация, форматирование и валидация
  - logger: сохранение контекста, вывод в консоль с цветом либо вывод в построчный json для продакшена, поддержка трассировок
  - metrics: prometheus совместимые метрики, автоматические метрики на контроллерах
  - trace: автоматические трейсы, поддержка пробрасывания информации о трейсах при внутрисистемных вызовах
  - requests: унифицированный сервис для запросов как для внитрисистемных вызовов так и для 3rd party
  - exception handling: унифицированный типизированный объект ошибки, его поддержка всеми встроенными сервисами, его обработка
  - service response standartization: унификация и строгая типизация ответов от вызываемых сервисов
  - cache: сервис для кеширования, поддержка как локального кеша (в памяти) так и Redis для шаренного хранилища, гибкое управление ttl
  - http: встроенный веб-сервер, возможность простой генерации типизированного клиента для вызова своих эндпоинтов
  - ws: встроенный ws-сервер, возможность простой генерации типизированного клиента для вызова своих эндпоинтов, поддержка легковесных diff-ов для сообщений об обновлении информации
  - auth: встроенный способ межсервисной авторизации, поддержка как простого Bearer протокола, так и криптографических подписей, возможность управления доступами к конкретным контроллерам или даже эндпоинтам через декораторы, уникальные credentionals для каждого вызывающего сервиса
  - healthcheck: стандартизация человекочитаемого ответа для хэлсчеков, встроенные хэлсчеки для инфраструктурных зависимостей (БД, кафка, кэш, другой сервис)
  - hc vault: встроенный сервис для общения с HashiCorp Vault, хранение данных, управление ролями и токенами доступа
  - validation: типизированная стандартизированная валидация входящих и выходящих данных без дублирования кода для валидации, типов и сваггер-документации
  - swagger: автоматический сбор сваггер-документации на основе типов и декораторов
  - pretty docs: автоматизированный сбор страницы документации в современном виде (например, с использованием redoc)
  - base configs
    - tsconfig: базовый конфиг со всеми необходимыми настройками, чтобы при создании приложений можно было просто от него отнаследоваться
    - biome: базовый конфиг со всеми необходимыми настройками, чтобы при создании приложений можно было просто от него отнаследоваться
    - werf: базовый конфиг со всеми необходимыми настройками, чтобы при создании приложений можно было просто от него отнаследоваться
  - modules
    - sqlite: отдельный модуль для работы с sqlite, строгая типизация, миграции, code first подход без дублирования кода модели БД и ts-типа
    - postgres: отдельный модуль для работы с postgres, строгая типизация, миграции, code first подход без дублирования кода модели БД и ts-типа
    - redis: отдельный модуль для работы с redis, строгая типизация, разумные дефолты, полнота функциональностей
    - kafka: сервис и декораторы для подписки на события и для эмита
    - clickhouse (or alternative): отдельный модуль для работы с clickhouse (или другая адекватная замена), строгая типизация, миграции, code first подход без дублирования кода модели БД и ts-типа
  - templates
    - single app: полноценное приложение на фреймворке со всеми необходимыми зависимостями и базовыми настройками
    - multi app: то же, что и single app, но предназначенный для работы нескольких сервисов (запускаемых как отдельные поды, отдельные процессы или в рамках одного процесса) из одного репозитория, аналог nestjs microservices
  - cli tool
    - create project from templates: интерактивный cli tool для управления приложением на фреймворке, возможность разворачивать шаблоны, возможность добавлять встроенные фукнции, возможность создавать встроенные обхекты (модули, контроллеры и т.д.)
- template services: готовые приложения для решения конкретных проблем, преднастроенные и готовые к реализации бизнес-логики
  - library: сервис управления справочной и настроечной информации для всей системы, имеет CRUD эндпоинты для админки, имеет ws-сервер с клиентом для оперативной доставки данных другим сервисам, управляет фиче-флагами и подобным
  - inter service auth:
  - admin: сервис админского доступа ко всем микросервисам всей системы, дополнительно имеет rbac систему доступа админских юзеров (например, casl)
- temporal integration: конфиги, инструкции, образы для развёртвания temporal + модули и пакеты для его тесной интеграции с микросервисной системой на OneBun
- local infrastructure & local ci: конфиги, инструкции, образы для развёртывания инфраструктурных зависимостей сервиса на локальной машине разработчика, локальная эмуляция запуска на GitLab CI, туллинг для локального запуска тестов (юнит, интеграционные, нагрузочные) и ручной проверки работоспособности сервиса

Когда юзер захочет создать сервис на фреймворке OneBun, то он сможет с помощью cli (bunx) развернуть шаблон, в котором будет @oneban/framework и опциональные зависимости (core/modules), а всё то, что нужно каждому микросервису уже будет доступно и работать из коробки.

@oneban/framework, в свою очередь, собирает все отдельные пакеты в одну цельную сильно связанную структуру с разумными дефолтами (даже на уровне использованися переменных окружения), но с возможностью кастомизировать через дополнительные переданные опции.

# Общие положения

* Общение в чате происходит на русском языке с английскими терминами, но
  весь код, комментарии и контент должны быть на английском языке с расчётом на
  англоязычную аудиторию (с исключением для md-файлов)
* полезные ссылки на документации различных технологий, используемых в проекте, сохраняем
  в файле references.md в корне проекта и используем как дополнительную базу знаний,
  обращаясь в первую очередь туда. Следи, чтобы информация там была структурирована, актуальна,
  не дублировалась и была понятна как для человека (разработчика senior уровня) так и
  для ИИ-ассистента

# Используемый стек

* TypeScript с лучшими практиками (по минимуму any и т.д.), никакого JavaScript
* рантайм — bunjs. Не рассчитываем и не поддерживаем обратную совместимость с nodejs,
  т.е. все библиотеки и пакеты будут тоже вызываться из-под bunjs
* проект - это монорепо на bunjs
* используем библиотеку effect по максимуму, реализуя собственные аналоги её фичей только
  в случае крайней необходимости. Не используем вариант с Effect.gen и генераторами, а пользуемся
  Effect.pipe как и рекомендует документация
* проверяй возможные ошибки тайпскрипта через консольную команду `bunx tsc --noEmit` и исправляй
  их. Задача не считается выполненной, пока остаются неисправленные ошибки типизации
* проверяй возможные ошибки и предупреждения линтера через консольную команду `bun lint` и исправляй их.
  Задача не считается выполненной, пока остаются неисправленные проблемы линтинга
* проверяй что все тесты проходят через консольную команду `bun test` и исправляй их если это не так.
  Задача не считается выполненной, пока остаются падающие тесты или вдруг их количество или качество уменьшилось
  с предыдущей итерации

# Описание проекта

Проект "OneBun" — это фреймворк на TypeScript под bunjs рантайм. Идея проекта в том,
чтобы на каждую проблему был ровно один дефолтный/встроенный способ её решения,
т.е. жертвуем гибкостью ради скорости разработки и производительности.

Список фич фреймворка:
- core
  - decorators: базовые декораторы, аналогичные nest.js
  - envs: загрузка и управление переменными окружения, загрузка из файлов, изменение на лету, строгая типизация, форматирование и валидация
  - logger: сохранение контекста, вывод в консоль с цветом либо вывод в построчный json для продакшена, поддержка трассировок
  - metrics: prometheus совместимые метрики, автоматические метрики на контроллерах
  - trace: автоматические трейсы, поддержка пробрасывания информации о трейсах при внутрисистемных вызовах
  - requests: унифицированный сервис для запросов как для внутрисистемных вызовов так и для 3rd party
  - exception handling: унифицированный типизированный объект ошибки, его поддержка всеми встроенными сервисами, его обработка
  - service response standardization: унификация и строгая типизация ответов от вызываемых сервисов
  - cache: сервис для кеширования, поддержка как локального кеша (в памяти) так и Redis для шаренного хранилища, гибкое управление ttl
  - http: встроенный веб-сервер, возможность простой генерации типизированного клиента для вызова своих эндпоинтов
  - ws: встроенный ws-сервер, возможность простой генерации типизированного клиента для вызова своих эндпоинтов, поддержка легковесных diff-ов для сообщений об обновлении информации
  - auth: встроенный способ межсервисной авторизации, поддержка как простого Bearer протокола, так и криптографических подписей, возможность управления доступами к конкретным контроллерам или даже эндпоинтам через декораторы, уникальные credentials для каждого вызывающего сервиса
  - healthcheck: стандартизация человекочитаемого ответа для хэлсчеков, встроенные хэлсчеки для инфраструктурных зависимостей (БД, кафка, кэш, другой сервис)
  - hc vault: встроенный сервис для общения с HashiCorp Vault, хранение данных, управление ролями и токенами доступа
  - validation: типизированная стандартизированная валидация входящих и выходящих данных без дублирования кода для валидации, типов и сваггер-документации
  - swagger: автоматический сбор сваггер-документации на основе типов и декораторов
  - pretty docs: автоматизированный сбор страницы документации в современном виде (например, с использованием redoc)
  - base configs
    - tsconfig: базовый конфиг со всеми необходимыми настройками, чтобы при создании приложений можно было просто от него отнаследоваться
    - biome: базовый конфиг со всеми необходимыми настройками, чтобы при создании приложений можно было просто от него отнаследоваться
    - werf: базовый конфиг со всеми необходимыми настройками, чтобы при создании приложений можно было просто от него отнаследоваться
  - modules
    - sqlite: отдельный модуль для работы с sqlite, строгая типизация, миграции, code first подход без дублирования кода модели БД и ts-типа
    - postgres: отдельный модуль для работы с postgres, строгая типизация, миграции, code first подход без дублирования кода модели БД и ts-типа
    - redis: отдельный модуль для работы с redis, строгая типизация, разумные дефолты, полнота функциональностей
    - kafka: сервис и декораторы для подписки на события и для эмита
    - clickhouse (or alternative): отдельный модуль для работы с clickhouse (или другая адекватная замена), строгая типизация, миграции, code first подход без дублирования кода модели БД и ts-типа
  - templates
    - single app: полноценное приложение на фреймворке со всеми необходимыми зависимостями и базовыми настройками
    - multi app: то же, что и single app, но предназначенный для работы нескольких сервисов (запускаемых как отдельные поды, отдельные процессы или в рамках одного процесса) из одного репозитория, аналог nestjs microservices
  - cli tool
    - create project from templates: интерактивный cli tool для управления приложением на фреймворке, возможность разворачивать шаблоны, возможность добавлять встроенные функции, возможность создавать встроенные объекты (модули, контроллеры и т.д.)
- template services: готовые приложения для решения конкретных проблем, преднастроенные и готовые к реализации бизнес-логики
  - library: сервис управления справочной и настроечной информации для всей системы, имеет CRUD эндпоинты для админки, имеет ws-сервер с клиентом для оперативной доставки данных другим сервисам, управляет фиче-флагами и подобным
  - inter service auth:
  - admin: сервис админского доступа ко всем микросервисам всей системы, дополнительно имеет rbac систему доступа админских юзеров (например, casl)
- temporal integration: конфиги, инструкции, образы для развёртывания temporal + модули и пакеты для его тесной интеграции с микросервисной системой на OneBun
- local infrastructure & local ci: конфиги, инструкции, образы для развёртывания инфраструктурных зависимостей сервиса на локальной машине разработчика, локальная эмуляция запуска на GitLab CI, туллинг для локального запуска тестов (юнит, интеграционные, нагрузочные) и ручной проверки работоспособности сервиса

Когда юзер захочет создать сервис на фреймворке OneBun, то он сможет с помощью cli (bunx) развернуть шаблон, в котором будет @oneban/framework и опциональные зависимости (core/modules), а всё то, что нужно каждому микросервису уже будет доступно и работать из коробки.

@oneban/framework, в свою очередь, собирает все отдельные пакеты в одну цельную сильно связанную структуру с разумными дефолтами (даже на уровне использования переменных окружения), но с возможностью кастомизировать через дополнительные переданные опции.
Общение модулей внутри фреймворка по-умолчанию происходит с использованием effect.js, но для клиентского кода мыы используем промисы, как более понятные техники.

В папке /future-example находится желаемый вид клиентского приложения (ещё в работе) к которому должны прийти в процессе развития фреймворка, поэтому там допускается наличие ошибок типизации или линтера.

# OneBun Framework - План разработки

## Обзор проекта

OneBun - это фреймворк на TypeScript под bunjs рантайм. Основная идея проекта - предоставить для каждой проблемы ровно один дефолтный/встроенный способ её решения, жертвуя гибкостью ради скорости разработки и производительности.

## Текущее состояние проекта

### Реализовано

#### Core
- [x] Базовая структура проекта (монорепо)
- [x] Начальная реализация декораторов (аналогично nest.js)
- [x] Базовая реализация модулей
- [x] Базовая реализация контроллеров
- [x] Базовая реализация приложения

#### Logger
- [x] Базовая реализация логгера
- [x] Интеграция с Effect.js
- [x] Форматтеры для логов
- [x] Транспорты для логов

#### Пример приложения
- [x] Простой пример использования логгера
- [x] Пример использования сервисов с инъекцией зависимостей через Effect
- [x] Пример маршрутизации HTTP-запросов

## Что нужно реализовать

### Core

#### Декораторы и DI
- [x] Улучшение работы декораторов для маршрутов
- [x] Полноценная система инъекции зависимостей через модули и контроллеры

#### Envs
- [x] Загрузка и управление переменными окружения
- [x] Загрузка из файлов
- [x] Изменение на лету
- [x] Строгая типизация, форматирование и валидация

#### Metrics
- [x] Prometheus совместимые метрики
- [x] Автоматические метрики на контроллерах
- [x] Системные метрики (память, CPU, uptime)
- [x] Метрики сборки мусора
- [x] API для создания кастомных метрик
- [x] Декораторы для автоматического сбора метрик
- [x] Интеграция с Effect.js
- [x] Конфигурируемый endpoint для метрик

#### Trace
- [x] Автоматические трейсы
- [x] Поддержка пробрасывания информации о трейсах при внутрисистемных вызовах
- [x] Интеграция с Effect.js
- [x] OpenTelemetry-совместимый API
- [x] W3C Trace Context propagation
- [x] Декораторы для трейсинга методов (@Trace, @Span)
- [x] Автоматическое добавление trace информации в логи
- [x] HTTP request tracing с детальными атрибутами
- [x] Извлечение и внедрение trace context из/в HTTP заголовки
- [x] Конфигурируемый sampling rate
- [x] Custom span события и атрибуты

#### Logger (расширение)
- [x] Поддержка дополнительных параметров с красивым форматированием
- [x] Сохранение контекста
- [x] Поддержка трассировок

#### Requests
- [x] Унифицированный сервис для запросов
- [x] Поддержка внутрисистемных вызовов
- [x] Поддержка 3rd party вызовов
- [x] Множественные схемы авторизации (Bearer, API key, Basic, OneBun)
- [x] Автоматические ретраи с настраиваемыми стратегиями
- [x] Интеграция с трейсингом и метриками
- [x] Типизированные ошибки с цепочкой контекста
- [x] Единый формат ответов
- [x] Таймауты и конфигурируемые настройки

#### Exception handling
- [x] Унифицированный типизированный объект ошибки
- [x] Поддержка всеми встроенными сервисами
- [x] Обработка ошибок

#### Service response standardization
- [x] Унификация и строгая типизация ответов от вызываемых сервисов

#### Cache
- [ ] Сервис для кеширования
- [ ] Поддержка локального кеша (в памяти)
- [ ] Поддержка Redis для шаренного хранилища
- [ ] Гибкое управление TTL

#### HTTP
- [ ] Улучшение встроенного веб-сервера
- [ ] Возможность генерации типизированного клиента для вызова своих эндпоинтов

#### WS
- [ ] Встроенный WS-сервер
- [ ] Возможность генерации типизированного клиента для вызова своих эндпоинтов
- [ ] Поддержка легковесных diff-ов для сообщений об обновлении информации

#### Auth
- [ ] Встроенный способ межсервисной авторизации
- [ ] Поддержка Bearer протокола
- [ ] Поддержка криптографических подписей
- [ ] Управление доступами к контроллерам/эндпоинтам через декораторы
- [ ] Уникальные credentials для каждого вызывающего сервиса

#### Healthcheck
- [ ] Стандартизация человекочитаемого ответа для хэлсчеков
- [ ] Встроенные хэлсчеки для инфраструктурных зависимостей (БД, кафка, кэш, другой сервис)

#### HC Vault
- [ ] Встроенный сервис для общения с HashiCorp Vault
- [ ] Хранение данных
- [ ] Управление ролями и токенами доступа

#### Validation
- [ ] Типизированная стандартизированная валидация входящих и выходящих данных
- [ ] Устранение дублирования кода для валидации, типов и сваггер-документации

#### Swagger
- [ ] Автоматический сбор сваггер-документации на основе типов и декораторов

#### Pretty docs
- [ ] Автоматизированный сбор страницы документации в современном виде (например, с использованием redoc)

### Base configs
- [ ] tsconfig: базовый конфиг со всеми необходимыми настройками
- [ ] biome: базовый конфиг со всеми необходимыми настройками
- [ ] werf: базовый конфиг со всеми необходимыми настройками

### Modules
- [ ] sqlite: модуль для работы с sqlite
- [ ] postgres: модуль для работы с postgres
- [ ] redis: модуль для работы с redis
- [ ] kafka: сервис и декораторы для подписки на события и для эмита
- [ ] clickhouse (or alternative): модуль для работы с clickhouse

### Templates
- [ ] single app: полноценное приложение на фреймворке
- [ ] multi app: приложение для работы нескольких сервисов

### CLI tool
- [ ] create project from templates: интерактивный CLI tool для управления приложением
- [ ] возможность разворачивать шаблоны
- [ ] возможность добавлять встроенные функции
- [ ] возможность создавать встроенные объекты (модули, контроллеры и т.д.)

### Template services
- [ ] library: сервис управления справочной и настроечной информации
- [ ] inter service auth: сервис для межсервисной авторизации
- [ ] admin: сервис админского доступа ко всем микросервисам

### Temporal integration
- [ ] Конфиги, инструкции, образы для развёртвания temporal
- [ ] Модули и пакеты для интеграции с микросервисной системой на OneBun

### Local infrastructure & local CI
- [ ] Конфиги, инструкции, образы для развёртывания инфраструктурных зависимостей
- [ ] Локальная эмуляция запуска на GitLab CI
- [ ] Туллинг для локального запуска тестов
- [ ] Инструменты для ручной проверки работоспособности сервиса

## Приоритеты разработки

1. **Высокий приоритет**
   - Улучшение работы декораторов для маршрутов
   - Полноценная система инъекции зависимостей
   - Загрузка и управление переменными окружения
   - Расширение возможностей логгера
   - Обработка ошибок

2. **Средний приоритет**
   - HTTP и WS серверы
   - Валидация данных
   - Кеширование
   - Метрики и трейсы
   - Базовые конфиги

3. **Низкий приоритет**
   - Модули для работы с БД
   - Шаблоны приложений
   - CLI инструменты
   - Шаблонные сервисы
   - Интеграция с Temporal
   - Локальная инфраструктура и CI
